name: Block Pushes to Prod

on:
  push:
    branches:
      - prod

jobs:
  check_branch_name:
    name: Check Branch Name
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v2

      - name: Get Branch Name
        id: branch_name
        run: echo "::set-output name=name::${GITHUB_REF#refs/heads/}"

      - name: Check if branch name starts with feature/
        id: check_branch
        run: echo ::set-output name=valid::$(echo ${{ steps.branch_name.outputs.name }} | grep -q "^feature/" && echo true || echo false)

      - name: Block Push if Branch Name Invalid
        if: steps.check_branch.outputs.valid == 'false'
        run: |
          echo "Push to prod branch is not allowed if branch name doesn't start with 'feature/'."
          exit 1
